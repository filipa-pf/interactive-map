<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa Interativo</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { margin:0; padding:0; }
  #map { height: 100vh; width: 100vw; }

  /* Tooltip hover */
  #hoverBox {
    position: absolute;
    display: none;
    padding: 6px 10px;
    background: rgba(0,0,0,0.8);
    color: #fff;
    font-size: 14px;
    border-radius: 4px;
    pointer-events: none;
    transform: translate(-50%, -10px);
    transition: all 0.2s ease;
    white-space: nowrap;
    z-index: 1000;
  }

  /* Info box */
  #infoContent {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #fff;
    padding: 12px;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    z-index: 1000;
  }

  button {
    margin-top: 6px;
    padding: 5px 10px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="map"></div>
<div id="hoverBox"></div>
<div id="infoContent">Passe o mouse sobre um concelho</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  const map = L.map('map').setView([39.5, -8], 7); // centro aproximado de Portugal

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const hoverBox = document.getElementById('hoverBox');

  // Exemplo de cores por distrito
  const coresDistritos = {
    'Lisboa': '#f28e2c',
    'Porto': '#4e79a7',
    'Coimbra': '#e15759',
    'Faro': '#76b7b2'
    // Adicione os restantes distritos
  };

  // Função para escurecer cor
  function escurecerCor(hex, percent = 20) {
    const num = parseInt(hex.replace('#',''),16);
    let r = (num >> 16) - percent; r = r<0?0:r;
    let g = ((num >> 8) & 0x00FF) - percent; g = g<0?0:g;
    let b = (num & 0x0000FF) - percent; b = b<0?0:b;
    return `rgb(${r},${g},${b})`;
  }

  // GeoJSON exemplo (substituir pelo seu geojson real)
  const geojsonData = {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": { "con_name": "Lisboa", "dis_name": "Lisboa" },
        "geometry": {
          "type": "Polygon",
          "coordinates": [[[-9.2,38.7],[-9.1,38.7],[-9.1,38.8],[-9.2,38.8],[-9.2,38.7]]]
        }
      },
      {
        "type": "Feature",
        "properties": { "con_name": "Porto", "dis_name": "Porto" },
        "geometry": {
          "type": "Polygon",
          "coordinates": [[[-8.7,41.1],[-8.6,41.1],[-8.6,41.2],[-8.7,41.2],[-8.7,41.1]]]
        }
      }
    ]
  };

  const geojsonLayer = L.geoJSON(geojsonData, {
    style: feature => {
      const district = feature.properties.dis_name;
      return {
        color: '#000',
        weight: 1,
        fillOpacity: 0.6,
        fillColor: coresDistritos[district] || '#ccc'
      };
    },
    onEachFeature: (feature, layer) => {
      const { con_name, dis_name } = feature.properties;
      const cor = coresDistritos[dis_name] || '#ccc';
      const center = layer.getBounds().getCenter();

      layer.on('mouseover', () => {
        layer.setStyle({ fillColor: escurecerCor(cor) });
        hoverBox.style.display = 'block';
        hoverBox.innerText = con_name;

        const point = map.latLngToContainerPoint(center);
        hoverBox.style.left = point.x + 'px';
        hoverBox.style.top = point.y + 'px';
      });

      layer.on('mouseout', () => {
        layer.setStyle({ fillColor: cor });
        hoverBox.style.display = 'none';
      });

      layer.on('click', () => {
        document.getElementById('infoContent').innerHTML = 
          `<strong>${con_name}</strong><br>Distrito: ${dis_name}<br><button id="pdfBtn">Gerar PDF</button>`;
        document.getElementById('pdfBtn').onclick = () => {
          const doc = new jspdf.jsPDF();
          doc.text(`Concelho: ${con_name}\nDistrito: ${dis_name}`, 10, 10);
          doc.save(`${con_name}.pdf`);
        };
      });
    }
  }).addTo(map);

  // Atualiza a posição do hoverBox ao redimensionar ou mover o mapa
  map.on('move', () => {
    if (hoverBox.style.display === 'block') {
      geojsonLayer.eachLayer(layer => {
        if (layer.options.fillColor && layer._bounds && layer._bounds.contains(map.containerPointToLatLng([hoverBox.offsetLeft, hoverBox.offsetTop]))) {
          const center = layer.getBounds().getCenter();
          const point = map.latLngToContainerPoint(center);
          hoverBox.style.left = point.x + 'px';
          hoverBox.style.top = point.y + 'px';
        }
      });
    }
  });

</script>

</body>
</html>
