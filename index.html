<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Mapa de Portugal</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  #map { height: 90vh; width: 100%; }
  #infoContent { padding: 10px; background: #f7f7f7; border: 1px solid #ccc; margin-top: 10px; }
</style>
</head>
<body>

<div id="map"></div>
<div id="infoContent">Clique num concelho para ver info</div>

<script>
// Substitui pelo teu GeoJSON
const geojsonData = [ /* ... teus concelhos ... */ ];

// Cores por distrito
const coresDistritos = {
  'Lisboa': '#fdae61', 'Porto': '#fee08b', 'Açores': '#d73027', 'Madeira': '#4575b4'
};

// Função para escurecer cor
function escurecerCor(cor) {
  let c = cor.replace('#','');
  let num = parseInt(c,16);
  let r = Math.max((num >> 16) - 30,0);
  let g = Math.max(((num >> 8) & 0x00FF) - 30,0);
  let b = Math.max((num & 0x0000FF) - 30,0);
  return `#${(r<<16 | g<<8 | b).toString(16).padStart(6,'0')}`;
}

// Deslocar Açores e Madeira
function deslocarIlhas(feature) {
  const distrito = feature.properties.dis_name;
  if (distrito === 'Açores') {
    feature.geometry.coordinates = feature.geometry.coordinates.map(poly =>
      poly.map(ring => ring.map(coord => [coord[0] + 12, coord[1] - 6]))
    );
  } else if (distrito === 'Madeira') {
    feature.geometry.coordinates = feature.geometry.coordinates.map(poly =>
      poly.map(ring => ring.map(coord => [coord[0] + 8, coord[1] - 6]))
    );
  }
  return feature;
}

// Criar mapa
const map = L.map('map').setView([39.5, -8], 6);

// Adicionar camada base
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Map data © OpenStreetMap contributors'
}).addTo(map);

// Adicionar GeoJSON
L.geoJSON(geojsonData.map(deslocarIlhas), {
  style: feature => {
    const distrito = feature.properties.dis_name || '';
    return { 
      color: '#000', 
      weight: 1, 
      fillOpacity: 0.6,
      fillColor: coresDistritos[distrito] || '#ccc'
    };
  },
  onEachFeature: (feature, layer) => {
    const nome = feature.properties.con_name || 'Sem nome';
    const distrito = feature.properties.dis_name || 'Sem distrito';
    const corOriginal = coresDistritos[distrito] || '#ccc';

    layer.on('mouseover', () => layer.setStyle({ fillColor: escurecerCor(corOriginal) }));
    layer.on('mouseout', () => layer.setStyle({ fillColor: corOriginal }));

    layer.on('click', () => {
      document.getElementById('infoContent').innerHTML = `
        <strong>${nome}</strong><br>
        Distrito: ${distrito}<br>
        <button id="pdfBtn">Gerar PDF</button>
      `;
      document.getElementById('pdfBtn').onclick = () => {
        const doc = new jspdf.jsPDF();
        doc.text(`Concelho: ${nome}\nDistrito: ${distrito}`, 10, 10);
        doc.save(`${nome}.pdf`);
      };
    });
  }
}).addTo(map);
</script>

</body>
</html>
