<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mapa Interativo de Portugal</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  #map { height: 600px; width: 60%; float: left; }
  .info { width: 35%; float: left; padding-left: 20px; }
</style>
</head>
<body>

<div id="map"></div>
<div class="info">
  <h2>Info do concelho</h2>
  <p>Clique num concelho para gerar um PDF com o nome do concelho.</p>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  const { jsPDF } = window.jspdf;

  // Inicializar mapa
  const map = L.map('map', { zoomControl: true, attributionControl: false }).setView([39.5, -8], 7);

  fetch('concelhos.json')
    .then(res => res.json())
    .then(data => {
      if (data.type === "GeometryCollection") {
        const layers = [];

        data.geometries.forEach((geom, i) => {
          const feature = {
            type: "Feature",
            properties: { name: `Concelho ${i+1}` },
            geometry: geom
          };

          const layer = L.geoJSON(feature, {
            style: { color: '#556', weight: 1, fillColor: '#ccc', fillOpacity: 0.6 },
            onEachFeature: (feature, layer) => {
              // clique para gerar PDF
              layer.on('click', () => {
                const doc = new jsPDF();
                doc.setFontSize(22);
                doc.text(`Documento para o concelho de ${feature.properties.name}`, 20, 30);
                doc.setFontSize(14);
                doc.text("Este é um template automático.", 20, 50);
                doc.save(`Concelho_${feature.properties.name}.pdf`);
              });

              // hover highlight
              layer.on('mouseover', () => layer.setStyle({ fillColor: '#faa', weight: 2 }));
              layer.on('mouseout', () => layer.setStyle({ fillColor: '#ccc', weight: 1 }));
            }
          }).addTo(map);

          layers.push(layer);
        });

        // Ajustar zoom para mostrar todos os concelhos
        const group = L.featureGroup(layers);
        map.fitBounds(group.getBounds());
      } else {
        console.error("JSON não é um GeometryCollection!");
      }
    })
    .catch(err => console.error('Erro ao carregar JSON:', err));
</script>

</body>
</html>
